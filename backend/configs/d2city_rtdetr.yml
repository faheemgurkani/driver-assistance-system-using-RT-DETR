# RT-DETR Config for D2-City Dataset
# Uses registered D2CityDatasetRTDETR

__include__:
  - ./rtdetr_base/runtime.yml
  - ./rtdetr_base/rtdetr/include/dataloader.yml
  - ./rtdetr_base/rtdetr/include/optimizer.yml
  - ./rtdetr_base/rtdetr/include/rtdetr_r50vd.yml

task: detection

num_classes: 80  # COCO classes (for transfer learning)
remap_mscoco_category: True

train_dataloader:
  type: DataLoader
  dataset:
    type: D2CityDatasetRTDETR
    root_dir: ./datasets/d2_city
    frame_skip: 5
    max_frames_per_video: 100
    return_masks: False
    annotations_dir: ./data/annotations
    transforms:
      type: Compose
      ops:
        - type: RandomPhotometricDistort
        - type: RandomZoomOut
          max_size: 1333
        - type: RandomHorizontalFlip
          p: 0.5
        - type: Resize
          size: [640, 640]
        - type: ToImageTensor
        - type: ConvertDtype
        - type: SanitizeBoundingBox
  shuffle: True
  batch_size: 8
  num_workers: 4
  drop_last: True

val_dataloader:
  type: DataLoader
  dataset:
    type: D2CityDatasetRTDETR
    root_dir: ./datasets/d2_city
    frame_skip: 10
    max_frames_per_video: 50
    return_masks: False
    annotations_dir: ./data/annotations
    transforms:
      type: Compose
      ops:
        - type: Resize
          size: [640, 640]
        - type: ToImageTensor
        - type: ConvertDtype
        - type: SanitizeBoundingBox
  shuffle: False
  batch_size: 8
  num_workers: 4
  drop_last: False

output_dir: ./output/d2city_rtdetr_r101vd

# Fine-tuning settings
epoches: 1
log_step: 10
checkpoint_step: 5
use_ema: True
use_amp: True
clip_max_norm: 0.1

